{% extends "layout.html" %} {% block title %}Orçamento Cliente{% endblock %} {%
block content %}
<link
  rel="stylesheet"
  href="https://cdnjs.cloudflare.com/ajax/libs/bootstrap-icons/1.11.3/font/bootstrap-icons.min.css"
/>

<style>
  body {
    background-color: #f6f8fa;
  }

  .container {
    max-width: 850px;
    margin: 0 auto;
  }

  .card {
    border-radius: 12px;
    box-shadow: 0 2px 6px rgba(0, 0, 0, 0.08);
  }

  h2,
  h3,
  h5 {
    color: #0d5590;
    font-weight: bold;
  }

  label {
    font-size: 0.9rem;
    font-weight: 600;
  }

  .form-control,
  .form-select {
    border-radius: 8px;
    border: 1px solid #ccc;
    padding: 10px;
    transition: all 0.2s ease-in-out;
  }

  .form-control:focus,
  .form-select:focus {
    border-color: #0d5590;
    box-shadow: 0 0 4px rgba(13, 85, 144, 0.3);
  }

  .btn-main {
    background-color: #0d5590;
    color: white;
    border: none;
    border-radius: 8px;
    padding: 10px 15px;
    font-weight: 600;
    transition: background-color 0.2s;
  }

  .btn-main:hover {
    background-color: #0b4575;
  }

  .item-row {
    display: flex;
    justify-content: space-between;
    align-items: center;
    background-color: #f9fafb;
    border: 1px solid #e5e7eb;
    padding: 8px 12px;
    border-radius: 8px;
    margin-bottom: 6px;
  }

  .item-row span {
    font-size: 0.95rem;
  }

  .item-row button {
    background: none;
    border: none;
    color: #dc3545;
    cursor: pointer;
    font-size: 0.9rem;
  }

  #lista-itens {
    margin-top: 10px;
  }

  #valor-total {
    font-weight: bold;
    color: #0d5590;
  }

  .section-box {
    background-color: #f9fafc;
    border-radius: 8px;
    padding: 15px;
  }

  @media (max-width: 600px) {
    .item-row {
      flex-direction: column;
      align-items: flex-start;
      gap: 6px;
    }

    .btn-main {
      width: 100%;
    }

    h2,
    h3 {
      text-align: center;
    }
  }
</style>

<div class="container my-4">
  <form class="p-3 card" id="laudo-form">
    <div class="text-center mb-4">
      <h2>Orçamento do Cliente</h2>
      <p class="text-muted mb-0" style="font-size: 0.9rem">
        Preencha os dados abaixo e adicione os itens do orçamento.
      </p>
    </div>

    <!-- DADOS DO CLIENTE -->
    <div class="row g-3">
      <div class="col-md-6">
        <label for="nome">Nome</label>
        <input
          class="form-control"
          type="text"
          id="nome"
          name="nome"
          required
        />
      </div>

      <div class="col-md-6">
        <label for="cpf">CPF/CNPJ</label>
        <input
          class="form-control"
          type="tel"
          id="cpf"
          name="cpf"
          oninput="formatarCpfCnpj(this)"
          required
        />
      </div>

      <div class="col-md-6">
        <label for="endereco">Endereço</label>
        <input
          class="form-control"
          type="text"
          id="endereco"
          name="endereco"
          required
        />
      </div>

      <div class="col-md-6">
        <label for="bairro">Bairro</label>
        <input
          class="form-control"
          type="text"
          id="bairro"
          name="bairro"
          required
        />
      </div>

      <div class="col-md-6">
        <label for="estado">Estado</label>
        <select id="estado" class="form-select" name="estado" required>
          <option value="">Selecionar</option>
          <option value="AL">Alagoas</option>
          <option value="BA">Bahia</option>
          <option value="GO">Goiás</option>
          <option value="SP">São Paulo</option>
          <option value="SC">Santa Catarina</option>
          <option value="RS">Rio Grande do Sul</option>
          <option value="DF">Distrito Federal</option>
          <option value="MG">Minas Gerais</option>
          <option value="PR">Paraná</option>
        </select>
      </div>

      <div class="col-md-6">
        <label for="cidade">Cidade</label>
        <select id="cidade" class="form-select" name="cidade">
          <option value="">Selecione um ESTADO primeiro</option>
        </select>
      </div>
    </div>

    <hr class="my-4" />

    <!-- ITENS DO ORÇAMENTO -->
    <div>
      <h3 class="mb-3">Adicionar Itens ao Orçamento</h3>

      <div class="row g-2 align-items-center">
        <div class="col-md-5 col-12">
          <select id="item-select" class="form-select">
            <option value="" disabled selected>Selecione um item</option>
            <option value="Vistoria">Vistoria</option>
            <option value="Reparo">Reparo</option>
            <option value="Mão de Obra">Mão de Obra</option>
            <option value="Materiais">Materiais</option>
          </select>
        </div>

        <div class="col-md-3 col-4">
          <input
            type="number"
            class="form-control"
            id="item-valor"
            placeholder="Valor (R$) Unitário"
          />
        </div>

        <div class="col-md-2 col-4">
          <input
            type="number"
            class="form-control"
            id="item-qtd"
            placeholder="Qtd"
            min="1"
            value="1"
          />
        </div>

        <div class="col-md-2 col-4 text-md-end">
          <button class="btn-main w-100" onclick="adicionarItem(event)">
            <i class="bi bi-plus-circle"></i> Add
          </button>
        </div>
      </div>

      <div class="mt-3">
        <input
          type="text"
          id="novo-item"
          class="form-control mb-2"
          placeholder="Adicionar novo tipo de item"
        />
        <button
          class="btn btn-outline-primary w-100"
          onclick="adicionarNovoItem(event)"
        >
          <i class="bi bi-plus"></i> Adicionar novo tipo
        </button>
      </div>

      <div class="mt-4">
        <h5>Itens no orçamento:</h5>
        <div id="lista-itens"></div>
        <div class="mt-3 text-end">
          <span>Total: <span id="valor-total">0,00</span></span>
        </div>
      </div>
    </div>

    <!-- SERVIÇO EXECUTADO -->
    <hr class="my-4" />
    <div class="section-box my-4">
      <h3 class="mb-3">Serviço a ser Executado</h3>
      <div class="row">
        <div class="col-md-4">
          <div class="form-check mb-2">
            <input
              class="form-check-input"
              type="checkbox"
              value="geofone"
              id="geofonamentoCheckbox"
            />
            <label class="form-check-label" for="geofonamentoCheckbox"
              >Geofonamento</label
            >
          </div>
          <div class="form-check mb-2">
            <input
              class="form-check-input"
              type="checkbox"
              value="pressurizacao"
              id="pressurizacaoCheckbox"
            />
            <label class="form-check-label" for="pressurizacaoCheckbox"
              >Pressurização</label
            >
          </div>
        </div>
        <div class="col-md-4">
          <div class="form-check mb-2">
            <input
              class="form-check-input"
              type="checkbox"
              value="cameratermografica"
              id="cameraTermograficaCheckbox"
            />
            <label class="form-check-label" for="cameraTermograficaCheckbox"
              >Câmera Termográfica</label
            >
          </div>
          <div class="form-check mb-2">
            <input
              class="form-check-input"
              type="checkbox"
              value="sensordeumidade"
              id="sensorDeUmidadeCheckbox"
            />
            <label class="form-check-label" for="sensorDeUmidadeCheckbox"
              >Sensor de Umidade</label
            >
          </div>
        </div>
        <div class="col-md-4">
          <div class="form-check mb-2">
            <input
              class="form-check-input"
              type="checkbox"
              value="outroservico"
              id="outroServicoCheckbox"
            />
            <label class="form-check-label" for="outroServicoCheckbox">
              Outro serviço
            </label>
          </div>
        </div>
      </div>
      <!-- Campo que aparece ao marcar "Outro serviço" -->
      <div
        id="descricaoPersonalizadaContainer"
        class="mb-3"
        style="display: none"
      >
        <label
          for="descricaoPersonalizada"
          style="font-size: small; font-weight: bold"
          >Descrição do Serviço a ser Executado</label
        >
        <textarea
          class="form-control"
          id="descricaoPersonalizada"
          rows="3"
          placeholder="Descreva o serviço a ser executado"
        ></textarea>
      </div>
    </div>

    <!-- OBSERVAÇÃO -->
    <div class="mb-3">
      <label for="observacao">Observação</label>
      <textarea class="form-control" id="observacao" rows="3"></textarea>
    </div>

    <!-- RESPONSÁVEL -->
    <div class="mb-3">
      <label for="tecnico">Responsável</label>
      <select class="form-select" id="tecnico">
        <option value="">Selecionar Técnico</option>
        <option
          value="Venancio Benevides"
          data-cnpj="98.765.432/0001-45"
          data-imagem="assinaturavenancio.png"
        >
          Venancio Benevides
        </option>
        <option
          value="Alan Honorato"
          data-cnpj="43.973.146/0001-26"
          data-imagem="assinaturaalanhonorato.png"
        >
          Alan Honorato
        </option>
      </select>
    </div>

    <!-- DATA -->
    <div class="mb-3">
      <label for="data">Data</label>
      <input class="form-control" type="date" id="data" name="data" required />
    </div>

    <!-- BOTÃO PDF -->
    <div class="my-4">
      <button type="button" onclick="gerarPDF()" class="btn-main w-100">
        <i class="bi bi-file-earmark-pdf"></i> Baixar PDF
      </button>
    </div>
  </form>
</div>

<script>
  document.addEventListener("DOMContentLoaded", function () {
    const outroServicoCheckbox = document.getElementById(
      "outroServicoCheckbox"
    );
    const descricaoContainer = document.getElementById(
      "descricaoPersonalizadaContainer"
    );

    // Exibe ou oculta o campo de descrição ao marcar o checkbox
    outroServicoCheckbox.addEventListener("change", function () {
      if (this.checked) {
        descricaoContainer.style.display = "block";
      } else {
        descricaoContainer.style.display = "none";
        document.getElementById("descricaoPersonalizada").value = "";
      }
    });
  });
</script>
<script>
  function exibirRevisaoDeConta() {
    const tipoRelatorio = document.getElementById(
      "tipodeservicoVistoria"
    ).value;

    // Oculta todas as divs
    document.getElementById("verificacao-conta-alta").style.display = "none";

    // Exibe a div correspondente
    if (tipoRelatorio === "Conta Alta") {
      document.getElementById("verificacao-conta-alta").style.display = "block";
    }
  }
</script>

<script src="https://cdn.jsdelivr.net/npm/luxon@3/build/global/luxon.min.js"></script>
<script>
  const DateTime = luxon.DateTime;
  const nowInSaoPaulo = DateTime.now().setZone("America/Sao_Paulo");
  const formattedDate = nowInSaoPaulo.toFormat("yyyy-MM-dd");
  const dateInput = document.getElementById("data");
  dateInput.value = formattedDate;

  const dateInputReparo = document.getElementById("data-reparo");
  dateInputReparo.value = formattedDate;
</script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.4.0/jspdf.umd.min.js"></script>
<script>
  function formatarCpfCnpj(input) {
    let valor = input.value.replace(/\D/g, ""); // Remove todos os caracteres não numéricos

    if (valor.length <= 11) {
      // Formatar como CPF: 123.456.789-09
      valor = valor.replace(/(\d{3})(\d)/, "$1.$2");
      valor = valor.replace(/(\d{3})(\d)/, "$1.$2");
      valor = valor.replace(/(\d{3})(\d{1,2})$/, "$1-$2");
    } else if (valor.length > 11 && valor.length <= 14) {
      // Formatar como CNPJ: 112.345.678/0001-23 ou 12.345.678/0001-23
      valor = valor.replace(/(\d{3})(\d)/, "$1.$2"); // Exemplo: 112.345
      valor = valor.replace(/(\d{3})(\d)/, "$1.$2"); // Exemplo: 112.345.678
      valor = valor.replace(/(\d{3})(\d)/, "$1/$2"); // Exemplo: 112.345.678/0001
      valor = valor.replace(/(\d{4})(\d{1,2})$/, "$1-$2"); // Exemplo: 112.345.678/0001-23
    } else if (valor.length > 14) {
      // Adaptar CNPJs maiores que 14 dígitos
      valor = valor.replace(/(\d{3})(\d)/, "$1.$2"); // Exemplo: 123.456
      valor = valor.replace(/(\d{3})(\d)/, "$1.$2"); // Exemplo: 123.456.789
      valor = valor.replace(/(\d{3})(\d)/, "$1/$2"); // Exemplo: 123.456.789/0012
      valor = valor.replace(/(\d{4})(\d{2})$/, "$1-$2"); // Exemplo: 123.456.789/0012-34
    }

    input.value = valor; // Atualiza o valor do campo
  }
</script>
<script src="../static/js/orcamentoReparo.js"></script>

<script>
  const geofonamentoCheckbox = document.getElementById("geofonamentoCheckbox");
  const geofonamentoInfo = document.getElementById("geofonamentoInfo");

  geofonamentoCheckbox.addEventListener("change", function () {
    // Verifica se o checkbox está marcado
    if (this.checked) {
      geofonamentoInfo.style.display = "block"; // Mostra as informações
    } else {
      geofonamentoInfo.style.display = "none"; // Oculta as informações
    }
  });
</script>
<script>
  const maxWords = 15; // Limite máximo de palavras

  // Seleciona apenas os inputs que têm o atributo data-limit="true"
  const inputFields = document.querySelectorAll('input[data-limit="true"]');

  // Adiciona o evento a cada input de texto com o atributo data-limit="true"
  inputFields.forEach((input) => {
    input.addEventListener("input", function () {
      const words = this.value.split(/\s+/).filter((word) => word.length > 0); // Divide em palavras e remove vazias
      if (words.length > maxWords) {
        this.value = words.slice(0, maxWords).join(" "); // Limita ao número máximo de palavras
      }
    });

    input.addEventListener("keydown", function (event) {
      const words = this.value.split(/\s+/).filter((word) => word.length > 0); // Conta as palavras atuais
      if (
        words.length >= maxWords &&
        event.key !== "Backspace" &&
        event.key !== "Delete"
      ) {
        event.preventDefault(); // Bloqueia novas entradas
      }
    });
  });
</script>

<script>
  document.addEventListener("DOMContentLoaded", function () {
    configurarFormatacaoValor("valorlocalizacao");
    configurarFormatacaoValor("valorreparo");
    configurarFormatacaoValor("valortotal");
  });
</script>
<script>
  // Função para remover a formatação do valor formatado
  function removerFormatacao(valorFormatado) {
    let valor = valorFormatado.replace(/\D/g, "");

    // Limita o valor ao menos a 3 dígitos (2 para decimais)
    valor = valor.padStart(3, "0");

    // Mantém as últimas 2 casas para as decimais
    const parteInteira = valor.slice(0, -2).replace(/^0+(?=\d)/, ""); // Remove zeros extras à esquerda
    const parteDecimal = valor.slice(-2);

    const parteInteiraFormatada = parteInteira
      .replace(/\./g, "")
      .replace(",", "."); // Remove pontos e troca vírgula por ponto

    //const parteInteiraFormatada = parteInteira.replace(/\B(?=(\d{3})+(?!\d))/g, ".");
    // Atualiza o valor no campo de entrada
    const valorNumerico = `${parteInteiraFormatada}.${parteDecimal}`;
    console.log(valorNumerico);
    const t = parseFloat(valorNumerico);
    console.log(t);
    return parseFloat(valorNumerico) || 0; // Converte para número
  }

  // Seleciona os campos de entrada
  const valorLocalizacaoInput = document.getElementById("valorlocalizacao");
  const valorReparoInput = document.getElementById("valorreparo");
  const valorTotalDiv = document.getElementById("valortotal");

  // Função para calcular a soma e atualizar o total
  function atualizarValorTotal() {
    const valorLocalizacao = removerFormatacao(valorLocalizacaoInput.value);
    const valorReparo = removerFormatacao(valorReparoInput.value);

    const valorTotal = valorLocalizacao + valorReparo;

    valorTotalDiv.textContent = valorTotal.toLocaleString("pt-BR", {
      minimumFractionDigits: 2,
      maximumFractionDigits: 2,
    });
  }

  // Adiciona eventos para atualizar o total ao digitar nos campos
  valorLocalizacaoInput.addEventListener("input", atualizarValorTotal);
  valorReparoInput.addEventListener("input", atualizarValorTotal);
</script>

<script>
  const selectEstado = document.getElementById("estado");
  const selectCidade = document.getElementById("cidade");

  // Objeto que mapeia as opções
  const optionsMap = {
    AL: [
      { value: "Maceió", text: "Maceió" },
      { value: "Satuba", text: "Satuba" },
      { value: "Santa Luzia do Norte", text: "Santa Luzia do Norte" },
      { value: "Coqueiro Seco", text: "Coqueiro Seco" },
      { value: "Cadoz", text: "Cadoz" },
      { value: "Rio Largo", text: "Rio Largo" },
      { value: "Marechal Deodoro", text: "Marechal Deodoro" },
      { value: "Santa Luzia", text: "Santa Luzia" },
      { value: "Barra de São Miguel", text: "Barra de São Miguel" },
      { value: "Pilar", text: "Pilar" },
      { value: "Atalaia", text: "Atalaia" },
      { value: "Murici", text: "Murici" },
      { value: "Messias", text: "Messias" },
      { value: "Barra de Santo Antônio", text: "Barra de Santo Antônio" },
      { value: "Paripueira", text: "Paripueira" },
      { value: "Arapiraca", text: "Arapiraca" },
    ],
    BA: [
      { value: "Salvador", text: "Salvador" },
      { value: "Camaçari", text: "Camaçari" },
      { value: "Feira de Santana", text: "Feira de Santana" },
      { value: "Lauro de Freitas", text: "Lauro de Freitas" },
      { value: "Simões Filho", text: "Simões Filho" },
      { value: "Gamboa", text: "Gamboa" },
      { value: "Vera Cruz", text: "Vera Cruz" },
      { value: "Itaparica", text: "Itaparica" },
      { value: "Mata de São João", text: "Mata de São João" },
      { value: "Alagoinhas", text: "Alagoinhas" },
      { value: "Madre De Deus", text: "Madre De Deus" },
      { value: "Salinas das Margaridas", text: "Salinas das Margaridas" },
    ],
    GO: [
      { value: "Goiânia", text: "Goiânia" },
      { value: "Aparecida de Goiânia", text: "Aparecida de Goiânia" },
      { value: "Senador Canedo", text: "Senador Canedo" },
      { value: "Trindade", text: "Trindade" },
      { value: "Anápolis", text: "Anápolis" },
      { value: "Goianira", text: "Goianira" },
      { value: "Rio Verde", text: "Rio Verde" },
      { value: "Bela Vista", text: "Bela Vista" },
      { value: "Hidrolândia", text: "Hidrolândia" },
      { value: "Nerópolis", text: "Nerópolis" },
      { value: "Cesarina", text: "Cesarina" },
      { value: "Guapó", text: "Guapó" },
      { value: "Aragoiânia", text: "Aragoiânia" },
      { value: "Maripotaba", text: "Maripotaba" },
      { value: "Palmeiras", text: "Palmeiras" },
    ],
    SP: [
      { value: "São Paulo", text: "São Paulo" },
      { value: "Osasco", text: "Osasco" },
      { value: "Barueri", text: "Barueri" },
      { value: "Campinas", text: "Campinas" },
      { value: "Itupeva", text: "Itupeva" },
      { value: "Franco Da Rocha", text: "Franco Da Rocha" },
      { value: "Jundiaí", text: "Jundiaí" },
      { value: "Campo Limpo Paulista", text: "Campo Limpo Paulista" },
      { value: "Louveira", text: "Louveira" },
      { value: "Várzea Paulista", text: "Várzea Paulista" },
      { value: "Vinhedo", text: "Vinhedo" },
      { value: "Valinhos", text: "Valinhos" },
      { value: "Hortolândia", text: "Hortolândia" },
      { value: "Paulínia", text: "Paulínia" },
      { value: "Itatiba", text: "Itatiba" },
      { value: "Indaiatuba", text: "Indaiatuba" },
      { value: "Jaguariúna", text: "Jaguariúna" },
      { value: "Sumaré", text: "Sumaré" },
      { value: "Diadema", text: "Diadema" },
      { value: "São Bernardo do Campo", text: "São Bernardo do Campo" },
      { value: "São Caetano do Sul", text: "São Caetano do Sul" },
      { value: "Santo André", text: "Santo André" },
      { value: "Nova Odessa", text: "Nova Odessa" },
      { value: "Atibaia", text: "Atibaia" },
      { value: "Americana", text: "Americana" },
      { value: "Guarulhos", text: "Guarulhos" },
      { value: "Poa", text: "Poa" },
      { value: "Mogi das Cruzes", text: "Mogi das Cruzes" },
      { value: "Itaquacetuba", text: "Itaquacetuba" },
      { value: "Cajamar", text: "Cajamar" },
      { value: "Amparo", text: "Amparo" },
      { value: "Capivari", text: "Capivari" },
      { value: "Limeira", text: "Limeira" },
      { value: "Sorocaba", text: "Sorocaba" },
    ],
    SC: [
      { value: "Florianópolis", text: "Florianópolis" },
      { value: "São José", text: "São José" },
      { value: "Palhoça", text: "Palhoça" },
      { value: "Biguaçu", text: "Biguaçu" },
    ],

    RS: [
      { value: "Porto Alegre", text: "Porto Alegre" },
      { value: "Canoas", text: "Canoas" },
      { value: "Glorinha", text: "Glorinha" },
      { value: "Guaíba", text: "Guaíba" },
      { value: "Gravataí", text: "Gravataí" },
      { value: "Novo Hamburgo", text: "Novo Hamburgo" },
      { value: "Viamão", text: "Viamão" },
      { value: "Esteio", text: "Esteio" },
      { value: "Alvorada", text: "Alvorada" },
      { value: "São Leopoldo", text: "São Leopoldo" },
      { value: "Barra do Ribeiro", text: "Barra do Ribeiro" },
      { value: "Eldorado do Sul", text: "Eldorado do Sul" },
      { value: "Sapucaia do Sul", text: "Sapucaia do Sul" },
      { value: "viamão", text: "Viamão" },
    ],

    PR: [
      { value: "Curitiba", text: "Curitiba" },
      { value: "São José dos Pinhais", text: "São José dos Pinhais" },
      { value: "Pinhais", text: "Pinhais" },
      { value: "Colombo", text: "Colombo" },
      { value: "Araucária", text: "Araucária" },
      { value: "Campo Largo", text: "Campo Largo" },
      { value: "Almirante Tamandaré", text: "Almirante Tamandaré" },
    ],

    MG: [
      { value: "Belo Horizonte", text: "Belo Horizonte" },
      { value: "Contagem", text: "Contagem" },
      { value: "Betim", text: "Betim" },
      { value: "Sabará", text: "Sabará" },
      { value: "Santa Luzia", text: "Santa Luzia" },
      { value: "Ibirité", text: "Ibirité" },
      { value: "Nova Lima", text: "Nova Lima" },
      { value: "Itabirito", text: "Itabirito" },
    ],
    DF: [{ value: "Brasília", text: "Brasília" }],
  };

  // Função que atualiza o segundo select com base na seleção do primeiro
  selectEstado.addEventListener("change", function () {
    const selectedValue = selectEstado.value;

    // Limpa o segundo select
    selectCidade.innerHTML = "<option value=''>Selecione uma Cidade</option>";

    // Se houver uma opção válida no primeiro select
    if (optionsMap[selectedValue]) {
      // Adiciona as novas opções no segundo select
      optionsMap[selectedValue].forEach((option) => {
        const newOption = document.createElement("option");
        newOption.value = option.value;
        newOption.text = option.text;
        selectCidade.appendChild(newOption);
      });
    }
  });
</script>

<script>
  let itensOrcamento = [];

  function adicionarItem(event) {
    event.preventDefault();

    const select = document.getElementById("item-select");
    const itemSelecionado = select.value;
    const valorUnit = parseFloat(
      document.getElementById("item-valor").value.trim()
    );
    const qtd = parseInt(document.getElementById("item-qtd").value.trim());

    if (!itemSelecionado || isNaN(valorUnit) || isNaN(qtd) || qtd <= 0) {
      alert("Selecione um item, informe valor e quantidade corretamente.");
      return;
    }

    const totalItem = valorUnit * qtd;

    itensOrcamento.push({
      nome: itemSelecionado,
      valorUnit,
      qtd,
      totalItem,
    });

    atualizarListaItens(document.getElementById("lista-itens"));
    atualizarTotal();

    // Limpa campos
    select.selectedIndex = 0;
    document.getElementById("item-valor").value = "";
    document.getElementById("item-qtd").value = "1";
  }

  function atualizarListaItens(lista) {
    lista.innerHTML = "";
    itensOrcamento.forEach((item, index) => {
      const row = document.createElement("div");
      row.className = "item-row";
      row.innerHTML = `
      <span><strong>${item.nome}</strong> — ${item.qtd} un</span>
      <span>R$ ${item.valorUnit.toFixed(2)} (unit.)</span>
      <span>Total: R$ ${item.totalItem.toFixed(2)}</span>
      <button type="button" onclick="removerItem(${index})">Remover</button>
    `;
      lista.appendChild(row);
    });
  }

  function removerItem(index) {
    itensOrcamento.splice(index, 1);
    atualizarListaItens(document.getElementById("lista-itens"));
    atualizarTotal();
  }

  function atualizarTotal() {
    const total = itensOrcamento.reduce((acc, item) => acc + item.totalItem, 0);
    document.getElementById("valor-total").textContent = total.toFixed(2);
  }

  function adicionarNovoItem(event) {
    event.preventDefault(); // Evita o recarregamento da página

    const novoItem = document.getElementById("novo-item").value.trim();
    const select = document.getElementById("item-select");

    if (!novoItem) {
      alert("Digite o nome do novo item.");
      return;
    }

    const existe = Array.from(select.options).some(
      (opt) => opt.value.toLowerCase() === novoItem.toLowerCase()
    );
    if (existe) {
      alert("Esse item já existe.");
      return;
    }

    const option = document.createElement("option");
    option.value = novoItem;
    option.textContent = novoItem;
    select.appendChild(option);

    document.getElementById("novo-item").value = "";
  }
</script>

{% endblock %}
